"use strict";var mongoose=require("mongoose"),Expense=require("../models/Expense"),User=require("../models/User"),createExpense=function(t,r){var n,s,a,o,u,c,p;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=t.body,s=n.userId,a=n.title,o=n.amount,u=n.category,c=n.expenseDate,s&&a&&o&&u&&c){e.next=4;break}return e.abrupt("return",r.status(400).json({message:"All fields are required"}));case 4:return e.next=6,regeneratorRuntime.awrap(User.findById(s));case 6:if(e.sent){e.next=9;break}return e.abrupt("return",r.status(404).json({message:"User not found"}));case 9:return e.next=11,regeneratorRuntime.awrap(Expense.create({userId:s,title:a,amount:o,category:u,expenseDate:c}));case 11:p=e.sent,r.status(201).json(p),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),r.status(500).json({error:e.t0.message});case 18:case"end":return e.stop()}},null,null,[[0,15]])},getExpensesByUser=function(t,r){var n,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.params.userId,e.next=4,regeneratorRuntime.awrap(Expense.find({userId:n}).sort({expenseDate:-1}));case 4:s=e.sent,r.json(s),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),r.status(500).json({error:e.t0.message});case 11:case"end":return e.stop()}},null,null,[[0,8]])},getMonthlyTotal=function(t,r){var n,s,a,o,u,c,p;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=t.params.userId,s=t.query,a=s.year,o=s.month,a&&o){e.next=5;break}return e.abrupt("return",r.status(400).json({message:"Year and month are required"}));case 5:return u=new Date(a,o-1,1),c=new Date(a,o,1),e.next=9,regeneratorRuntime.awrap(Expense.aggregate([{$match:{userId:new mongoose.Types.ObjectId(n),expenseDate:{$gte:u,$lt:c}}},{$group:{_id:null,totalAmount:{$sum:"$amount"}}}]));case 9:p=e.sent,r.json({total:0<p.length?p[0].totalAmount:0}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),r.status(500).json({error:e.t0.message});case 16:case"end":return e.stop()}},null,null,[[0,13]])},getCategorySummary=function(t,r){var n,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.params.userId,e.next=4,regeneratorRuntime.awrap(Expense.aggregate([{$match:{userId:new mongoose.Types.ObjectId(n)}},{$group:{_id:"$category",totalSpent:{$sum:"$amount"}}},{$sort:{totalSpent:-1}}]));case 4:s=e.sent,r.json(s),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),r.status(500).json({error:e.t0.message});case 11:case"end":return e.stop()}},null,null,[[0,8]])};module.exports={createExpense:createExpense,getExpensesByUser:getExpensesByUser,getMonthlyTotal:getMonthlyTotal,getCategorySummary:getCategorySummary};
//# sourceMappingURL=expenseController.min.js.map
